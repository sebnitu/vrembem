{"version":3,"file":"scripts.modern.js","sources":["../src/defaults.js","../src/anchorPosition.js","../src/anchor.js","../src/state.js","../src/index.js"],"sourcesContent":["export default {\n  autoInit: false,\n  dataScroll: 'scroll-stash',\n  dataAnchor: 'scroll-stash-anchor',\n  selectorAnchor: '',\n  selectorAnchorParent: '',\n  selectorTopElem: '',\n  selectorBotElem: '',\n  alignment: 'nearest', // start | end | nearest\n  behavior: 'auto', // auto | smooth\n  anchorPadding: 16,\n  saveKey: 'ScrollStash',\n  throttleDelay: 100,\n  customEventPrefix: 'scroll-stash:',\n};\n","export const anchorPositionStart = (el, anchor, settings) => {\n  let pos = settings.anchorPadding;\n  if (settings.selectorTopElem) {\n    const topElem = el.querySelector(settings.selectorTopElem);\n    if (topElem) pos += topElem.offsetHeight;\n  }\n  return anchor.offsetTop - (pos);\n};\n\nexport const anchorPositionEnd = (el, anchor, settings) => {\n  let pos = settings.anchorPadding;\n  if (settings.selectorBotElem) {\n    const botElem = el.querySelector(settings.selectorBotElem);\n    if (botElem) pos += botElem.offsetHeight;\n  }\n  return anchor.offsetTop - (el.offsetHeight - (anchor.offsetHeight + pos));\n};\n\nexport const anchorPositionCenter = (el, anchor, settings) => {\n  const posTop = anchorPositionStart(el, anchor, settings);\n  const posBot = anchorPositionEnd(el, anchor, settings);\n  return posBot + ((posTop - posBot) / 2);\n};\n\nexport const anchorPositionNearest = (el, anchor, settings) => {\n  const posTop = anchorPositionStart(el, anchor, settings);\n  const posBot = anchorPositionEnd(el, anchor, settings);\n  if (el.scrollTop > posTop) return posTop;\n  if (el.scrollTop < posBot) return posBot;\n  return false;\n};\n\nexport const anchorInView = (el, anchor, settings) => {\n  const posTop = anchorPositionStart(el, anchor, settings);\n  const posBot = anchorPositionEnd(el, anchor, settings);\n\n  if (el.scrollTop > posTop || el.scrollTop < posBot) return false;\n  return true;\n};\n\nexport const anchorPositionGet = (el, anchor, settings) => {\n  const inView = anchorInView(el, anchor, settings);\n  switch (settings.alignment) {\n    case 'start': return (inView) ? false : anchorPositionStart(el, anchor, settings);\n    case 'center': return (inView) ? false : anchorPositionCenter(el, anchor, settings);\n    case 'end': return (inView) ? false : anchorPositionEnd(el, anchor, settings);\n    case 'nearest': return anchorPositionNearest(el, anchor, settings);\n    default: return false;\n  }\n};\n","import { anchorPositionGet } from './anchorPosition';\n\nexport const anchorGet = (el, settings) => {\n  const dataAnchor = el.getAttribute(`data-${settings.dataAnchor}`);\n  if (dataAnchor == 'false' || dataAnchor == 'ignore') {\n    return null;\n  }\n\n  if (dataAnchor && el.querySelector(dataAnchor)) {\n    return el.querySelector(dataAnchor);\n  }\n\n  const selectorAnchor = (settings.selectorAnchor) ?\n    el.querySelector(settings.selectorAnchor) : null;\n  if (selectorAnchor && settings.selectorAnchorParent) {\n    const parentAnchor = selectorAnchor.closest(settings.selectorAnchorParent);\n    if (parentAnchor) return parentAnchor;\n  }\n\n  return (selectorAnchor) ? selectorAnchor : null;\n};\n\nexport const anchorShow = (el, behavior, settings) => {\n  const anchor = anchorGet(el, settings);\n\n  if (anchor) {\n    const position = anchorPositionGet(el, anchor, settings);\n    if (position) {\n      behavior = (behavior) ? behavior : settings.behavior;\n      el.scroll({\n        top: position,\n        behavior: behavior\n      });\n      el.dispatchEvent(new CustomEvent(settings.customEventPrefix + 'anchor', {\n        bubbles: true,\n        detail: {\n          scrolled: { value: position, behavior: behavior },\n          key: el.getAttribute(`data-${settings.dataScroll}`)\n        }\n      }));\n      return {\n        scrolled: { value: position, behavior: behavior },\n        msg: 'Anchor was scrolled into view'\n      };\n    } else {\n      return { scrolled: false, msg: 'Anchor is already in view' };\n    }\n  } else {\n    return { scrolled: false, msg: 'Anchor was not found' };\n  }\n};\n","export const stateSave = (settings) => {\n  const state = {};\n  const scrolls = document.querySelectorAll(`[data-${settings.dataScroll}]`);\n  scrolls.forEach((el) => {\n    const id = el.getAttribute(`data-${settings.dataScroll}`);\n    if (id) state[id] = el.scrollTop;\n  });\n  localStorage.setItem(settings.saveKey, JSON.stringify(state));\n  document.dispatchEvent(new CustomEvent(settings.customEventPrefix + 'saved', {\n    bubbles: true,\n    detail: { state: state }\n  }));\n  return state;\n};\n\nexport const stateSet = (settings) => {\n  if (localStorage.getItem(settings.saveKey)) {\n    let state = JSON.parse(localStorage.getItem(settings.saveKey));\n    Object.keys(state).forEach((key) => {\n      const item = document.querySelector(\n        `[data-${settings.dataScroll}=\"${key}\"]`\n      );\n      if (item) item.scrollTop = state[key];\n    });\n    document.dispatchEvent(new CustomEvent(settings.customEventPrefix + 'applied', {\n      bubbles: true,\n      detail: { state: state }\n    }));\n    return state;\n  } else {\n    return {};\n  }\n};\n","import defaults from './defaults';\nimport { anchorGet, anchorShow } from './anchor';\nimport { stateSave, stateSet } from './state';\n\nexport default class ScrollStash {\n  constructor(options) {\n    this.settings = { ...defaults, ...options };\n    this.state = {};\n    this.scrolls = [];\n    this.ticking = false;\n    this.__handler = this.handler.bind(this);\n    if (this.settings.autoInit) this.init();\n  }\n\n  init(options = null) {\n    if (options) this.settings = { ...this.settings, ...options };\n    this.state = stateSet(this.settings);\n    this.state = (!Object.keys(this.state).length) ? stateSave(this.settings) : this.state;\n    this.scrolls = document.querySelectorAll(`[data-${this.settings.dataScroll}]`);\n    this.scrolls.forEach((item) => {\n      item.addEventListener('scroll', this.__handler, false);\n      anchorShow(item, false, this.settings);\n    });\n  }\n\n  destroy() {\n    this.scrolls.forEach((item) => {\n      item.removeEventListener('scroll', this.__handler, false);\n    });\n    this.state = {};\n    this.scrolls = [];\n    localStorage.removeItem(this.settings.saveKey);\n  }\n\n  handler() {\n    if (this.ticking) return;\n    this.ticking = true;\n    setTimeout(() => {\n      this.state = stateSave(this.settings);\n      this.ticking = false;\n    }, this.settings.throttleDelay);\n  }\n\n  anchorGet(el) {\n    return anchorGet(el, this.settings);\n  }\n\n  anchorShow(el, behavior) {\n    return anchorShow(el, behavior, this.settings);\n  }\n}\n"],"names":["autoInit","dataScroll","dataAnchor","selectorAnchor","selectorAnchorParent","selectorTopElem","selectorBotElem","alignment","behavior","anchorPadding","saveKey","throttleDelay","customEventPrefix","anchorPositionStart","el","anchor","settings","pos","topElem","querySelector","offsetHeight","offsetTop","anchorPositionEnd","botElem","anchorGet","getAttribute","parentAnchor","closest","anchorShow","position","inView","posTop","posBot","scrollTop","anchorInView","anchorPositionCenter","anchorPositionNearest","anchorPositionGet","scroll","top","dispatchEvent","CustomEvent","bubbles","detail","scrolled","value","key","msg","stateSave","state","document","querySelectorAll","forEach","id","localStorage","setItem","JSON","stringify","constructor","options","this","defaults","scrolls","ticking","__handler","handler","bind","init","getItem","parse","Object","keys","item","stateSet","length","addEventListener","destroy","removeEventListener","removeItem","setTimeout"],"mappings":"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"}