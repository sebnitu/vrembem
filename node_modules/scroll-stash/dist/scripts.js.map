{"version":3,"file":"scripts.js","sources":["../src/defaults.js","../src/anchorPosition.js","../src/anchor.js","../src/state.js","../src/index.js"],"sourcesContent":["export default {\n  autoInit: false,\n  dataScroll: 'scroll-stash',\n  dataAnchor: 'scroll-stash-anchor',\n  selectorAnchor: '',\n  selectorAnchorParent: '',\n  selectorTopElem: '',\n  selectorBotElem: '',\n  alignment: 'nearest', // start | end | nearest\n  behavior: 'auto', // auto | smooth\n  anchorPadding: 16,\n  saveKey: 'ScrollStash',\n  throttleDelay: 100,\n  customEventPrefix: 'scroll-stash:',\n};\n","export const anchorPositionStart = (el, anchor, settings) => {\n  let pos = settings.anchorPadding;\n  if (settings.selectorTopElem) {\n    const topElem = el.querySelector(settings.selectorTopElem);\n    if (topElem) pos += topElem.offsetHeight;\n  }\n  return anchor.offsetTop - (pos);\n};\n\nexport const anchorPositionEnd = (el, anchor, settings) => {\n  let pos = settings.anchorPadding;\n  if (settings.selectorBotElem) {\n    const botElem = el.querySelector(settings.selectorBotElem);\n    if (botElem) pos += botElem.offsetHeight;\n  }\n  return anchor.offsetTop - (el.offsetHeight - (anchor.offsetHeight + pos));\n};\n\nexport const anchorPositionCenter = (el, anchor, settings) => {\n  const posTop = anchorPositionStart(el, anchor, settings);\n  const posBot = anchorPositionEnd(el, anchor, settings);\n  return posBot + ((posTop - posBot) / 2);\n};\n\nexport const anchorPositionNearest = (el, anchor, settings) => {\n  const posTop = anchorPositionStart(el, anchor, settings);\n  const posBot = anchorPositionEnd(el, anchor, settings);\n  if (el.scrollTop > posTop) return posTop;\n  if (el.scrollTop < posBot) return posBot;\n  return false;\n};\n\nexport const anchorInView = (el, anchor, settings) => {\n  const posTop = anchorPositionStart(el, anchor, settings);\n  const posBot = anchorPositionEnd(el, anchor, settings);\n\n  if (el.scrollTop > posTop || el.scrollTop < posBot) return false;\n  return true;\n};\n\nexport const anchorPositionGet = (el, anchor, settings) => {\n  const inView = anchorInView(el, anchor, settings);\n  switch (settings.alignment) {\n    case 'start': return (inView) ? false : anchorPositionStart(el, anchor, settings);\n    case 'center': return (inView) ? false : anchorPositionCenter(el, anchor, settings);\n    case 'end': return (inView) ? false : anchorPositionEnd(el, anchor, settings);\n    case 'nearest': return anchorPositionNearest(el, anchor, settings);\n    default: return false;\n  }\n};\n","import { anchorPositionGet } from './anchorPosition';\n\nexport const anchorGet = (el, settings) => {\n  const dataAnchor = el.getAttribute(`data-${settings.dataAnchor}`);\n  if (dataAnchor == 'false' || dataAnchor == 'ignore') {\n    return null;\n  }\n\n  if (dataAnchor && el.querySelector(dataAnchor)) {\n    return el.querySelector(dataAnchor);\n  }\n\n  const selectorAnchor = (settings.selectorAnchor) ?\n    el.querySelector(settings.selectorAnchor) : null;\n  if (selectorAnchor && settings.selectorAnchorParent) {\n    const parentAnchor = selectorAnchor.closest(settings.selectorAnchorParent);\n    if (parentAnchor) return parentAnchor;\n  }\n\n  return (selectorAnchor) ? selectorAnchor : null;\n};\n\nexport const anchorShow = (el, behavior, settings) => {\n  const anchor = anchorGet(el, settings);\n\n  if (anchor) {\n    const position = anchorPositionGet(el, anchor, settings);\n    if (position) {\n      behavior = (behavior) ? behavior : settings.behavior;\n      el.scroll({\n        top: position,\n        behavior: behavior\n      });\n      el.dispatchEvent(new CustomEvent(settings.customEventPrefix + 'anchor', {\n        bubbles: true,\n        detail: {\n          scrolled: { value: position, behavior: behavior },\n          key: el.getAttribute(`data-${settings.dataScroll}`)\n        }\n      }));\n      return {\n        scrolled: { value: position, behavior: behavior },\n        msg: 'Anchor was scrolled into view'\n      };\n    } else {\n      return { scrolled: false, msg: 'Anchor is already in view' };\n    }\n  } else {\n    return { scrolled: false, msg: 'Anchor was not found' };\n  }\n};\n","export const stateSave = (settings) => {\n  const state = {};\n  const scrolls = document.querySelectorAll(`[data-${settings.dataScroll}]`);\n  scrolls.forEach((el) => {\n    const id = el.getAttribute(`data-${settings.dataScroll}`);\n    if (id) state[id] = el.scrollTop;\n  });\n  localStorage.setItem(settings.saveKey, JSON.stringify(state));\n  document.dispatchEvent(new CustomEvent(settings.customEventPrefix + 'saved', {\n    bubbles: true,\n    detail: { state: state }\n  }));\n  return state;\n};\n\nexport const stateSet = (settings) => {\n  if (localStorage.getItem(settings.saveKey)) {\n    let state = JSON.parse(localStorage.getItem(settings.saveKey));\n    Object.keys(state).forEach((key) => {\n      const item = document.querySelector(\n        `[data-${settings.dataScroll}=\"${key}\"]`\n      );\n      if (item) item.scrollTop = state[key];\n    });\n    document.dispatchEvent(new CustomEvent(settings.customEventPrefix + 'applied', {\n      bubbles: true,\n      detail: { state: state }\n    }));\n    return state;\n  } else {\n    return {};\n  }\n};\n","import defaults from './defaults';\nimport { anchorGet, anchorShow } from './anchor';\nimport { stateSave, stateSet } from './state';\n\nexport default class ScrollStash {\n  constructor(options) {\n    this.settings = { ...defaults, ...options };\n    this.state = {};\n    this.scrolls = [];\n    this.ticking = false;\n    this.__handler = this.handler.bind(this);\n    if (this.settings.autoInit) this.init();\n  }\n\n  init(options = null) {\n    if (options) this.settings = { ...this.settings, ...options };\n    this.state = stateSet(this.settings);\n    this.state = (!Object.keys(this.state).length) ? stateSave(this.settings) : this.state;\n    this.scrolls = document.querySelectorAll(`[data-${this.settings.dataScroll}]`);\n    this.scrolls.forEach((item) => {\n      item.addEventListener('scroll', this.__handler, false);\n      anchorShow(item, false, this.settings);\n    });\n  }\n\n  destroy() {\n    this.scrolls.forEach((item) => {\n      item.removeEventListener('scroll', this.__handler, false);\n    });\n    this.state = {};\n    this.scrolls = [];\n    localStorage.removeItem(this.settings.saveKey);\n  }\n\n  handler() {\n    if (this.ticking) return;\n    this.ticking = true;\n    setTimeout(() => {\n      this.state = stateSave(this.settings);\n      this.ticking = false;\n    }, this.settings.throttleDelay);\n  }\n\n  anchorGet(el) {\n    return anchorGet(el, this.settings);\n  }\n\n  anchorShow(el, behavior) {\n    return anchorShow(el, behavior, this.settings);\n  }\n}\n"],"names":["autoInit","dataScroll","dataAnchor","selectorAnchor","selectorAnchorParent","selectorTopElem","selectorBotElem","alignment","behavior","anchorPadding","saveKey","throttleDelay","customEventPrefix","anchorPositionStart","el","anchor","settings","pos","topElem","querySelector","offsetHeight","offsetTop","anchorPositionEnd","botElem","anchorGet","getAttribute","parentAnchor","closest","anchorShow","position","inView","posTop","posBot","scrollTop","anchorInView","anchorPositionCenter","anchorPositionNearest","anchorPositionGet","scroll","top","dispatchEvent","CustomEvent","bubbles","detail","scrolled","value","key","msg","stateSave","state","document","querySelectorAll","forEach","id","localStorage","setItem","JSON","stringify","options","this","defaults","scrolls","ticking","__handler","handler","bind","init","getItem","parse","Object","keys","item","stateSet","length","addEventListener","_this","destroy","removeEventListener","_this2","removeItem","setTimeout","_this3"],"mappings":"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"}