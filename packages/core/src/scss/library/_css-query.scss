@use "sass:list";
@use "sass:map";
@use "sass:meta";

@use "./media-min" as *;
@use "../variables/breakpoints" as *;
@use "../modules/css";

/// Define a dynamic CSS variable using maps and breakpoints.
/// @param {string} $prop
///   The custom property name.
/// @param {map | any} $value
///   The value of the custom property or a map of valid variables with breakpoints as the key.
/// @param {map} $breakpoints
///   A valid breakpoints map (e.g: core.$breakpoints).
@mixin css-query($module, $prop, $value, $breakpoints: $breakpoints) {
  // If padding is not a map, set the CSS var.
  @if meta.type-of($value) != 'map' {
    @include css.override($module, $prop, $value);
  }
  // Else padding is a map, loop through the breakpoints and output CSS var.
  @else {
    // Get the first item from breakpoints.
    $_firstKey: list.nth(list.nth($value, 1), 1);
    // Output the fist padding value in the map as the base CSS var.
    @include css.override($module, $prop, map.get($value, $_firstKey));
    // Loop through the breakpoints.
    @each $key, $bpValue in $breakpoints {
      // If key matches padding first key, skip it. We already output it.
      @if $key != $_firstKey {
        // If the breakpoint key exists in the padding map...
        @if map.has-key($value, $key) {
          // Output the media query with new CSS variable value.
          @include media-min($bpValue) {
            @include css.override($module, $prop, map.get($value, $key));
          }
        }
      }
    }
  }
}
