{"version":3,"file":"scripts.modern.js","sources":["../src/js/defaults.js","../src/js/handlers.js","../src/js/initialState.js","../index.js"],"sourcesContent":["export default {\n  autoInit: false,\n\n  // Data attributes\n  dataModal: 'modal',\n  dataDialog: 'modal-dialog',\n  dataOpen: 'modal-open',\n  dataClose: 'modal-close',\n  dataFocus: 'modal-focus',\n  dataRequired: 'modal-required',\n\n  // State classes\n  stateOpened: 'is-opened',\n  stateOpening: 'is-opening',\n  stateClosing: 'is-closing',\n  stateClosed: 'is-closed',\n\n  // Selector\n  selectorInert: null,\n  selectorOverflow: 'body',\n\n  // Feature toggles\n  customEventPrefix: 'modal:',\n  moveModals: {\n    ref: null,\n    type: null\n  },\n  setTabindex: true,\n  transition: true\n};\n","export async function handlerClick(event) {\n  // Working catch\n  if (this.working) return;\n\n  // Trigger click\n  const trigger = event.target.closest(`[data-${this.settings.dataOpen}]`);\n  if (trigger) {\n    event.preventDefault();\n    const modalKey = trigger.getAttribute(`data-${this.settings.dataOpen}`);\n    const fromModal = event.target.closest(`[data-${this.settings.dataModal}]`);\n    if (!fromModal) this.memory.trigger = trigger;\n    await this.close(!fromModal);\n    this.open(modalKey);\n    return;\n  }\n\n  // Close click\n  if (event.target.closest(`[data-${this.settings.dataClose}]`)) {\n    event.preventDefault();\n    this.close();\n    return;\n  }\n\n  // Root click\n  if (\n    event.target.hasAttribute(`data-${this.settings.dataModal}`) &&\n    !event.target.hasAttribute(`data-${this.settings.dataRequired}`)\n  ) {\n    this.close();\n    return;\n  }\n}\n\nexport function handlerKeyup(event) {\n  // Working catch\n  if (this.working) return;\n\n  if (event.key === 'Escape' || event.keyCode === 27) {\n    const target = document.querySelector(\n      `[data-${this.settings.dataModal}].${this.settings.stateOpened}`\n    );\n    if (target && !target.hasAttribute(`data-${this.settings.dataRequired}`)) {\n      this.close();\n    }\n  }\n}\n","import { addClass, removeClass } from '@vrembem/core/index';\nimport { setInert, setOverflowHidden } from '@vrembem/core/index';\nimport { focusTrigger } from '@vrembem/core/index';\n\nexport function setInitialState(obj) {\n  const modals = document.querySelectorAll(`[data-${obj.settings.dataModal}]`);\n  modals.forEach((el) => {\n    if (el.classList.contains(obj.settings.stateOpened)) {\n      setInert(false, obj.settings.selectorInert);\n      setOverflowHidden(false, obj.settings.selectorOverflow);\n      focusTrigger(obj);\n      obj.focusTrap.destroy();\n    }\n    removeClass(el,\n      obj.settings.stateOpened,\n      obj.settings.stateOpening,\n      obj.settings.stateClosing\n    );\n    addClass(el, obj.settings.stateClosed);\n  });\n}\n","import { hasClass } from '@vrembem/core/index';\nimport { setInert, setOverflowHidden, setTabindex } from '@vrembem/core/index';\nimport { FocusTrap, focusTarget, focusTrigger } from '@vrembem/core/index';\nimport { openTransition, closeTransition } from '@vrembem/core/index';\nimport { moveElement } from '@vrembem/core/index';\n\nimport defaults from './src/js/defaults';\nimport { handlerClick, handlerKeyup } from './src/js/handlers';\nimport { setInitialState } from './src/js/initialState';\n\nexport default class Modal {\n  constructor(options) {\n    this.defaults = defaults;\n    this.settings = { ...this.defaults, ...options };\n    this.working = false;\n    this.memory = {};\n    this.focusTrap = new FocusTrap();\n    this.__handlerClick = handlerClick.bind(this);\n    this.__handlerKeyup = handlerKeyup.bind(this);\n    if (this.settings.autoInit) this.init();\n  }\n\n  init(options = null) {\n    if (options) this.settings = { ...this.settings, ...options };\n    this.moveModals();\n    this.setTabindex(this.settings.setTabindex);\n    this.setInitialState();\n    document.addEventListener('click', this.__handlerClick, false);\n    document.addEventListener('touchend', this.__handlerClick, false);\n    document.addEventListener('keyup', this.__handlerKeyup, false);\n  }\n\n  destroy() {\n    this.memory = {};\n    document.removeEventListener('click', this.__handlerClick, false);\n    document.removeEventListener('touchend', this.__handlerClick, false);\n    document.removeEventListener('keyup', this.__handlerKeyup, false);\n  }\n\n  /**\n   * Helpers\n   */\n\n  getModal(modalKey) {\n    if (typeof modalKey !== 'string') return modalKey;\n    return document.querySelector(\n      `[data-${this.settings.dataModal}=\"${modalKey}\"]`\n    );\n  }\n\n  modalNotFound(key) {\n    return Promise.reject(\n      new Error(`Did not find modal with key: \"${key}\"`)\n    );\n  }\n\n  setTabindex(state = true) {\n    const selectorTabindex = `\n      [data-${this.settings.dataModal}]\n      [data-${this.settings.dataDialog}]\n    `;\n    setTabindex(state, selectorTabindex);\n  }\n\n  setInitialState() {\n    setInitialState(this);\n  }\n\n  moveModals(type = this.settings.moveModals.type, ref = this.settings.moveModals.ref) {\n    const modals = document.querySelectorAll(`[data-${this.settings.dataModal}]`);\n    if (modals.length) moveElement(modals, type, ref);\n  }\n\n  /**\n   * Change state functionality\n   */\n\n  async open(modalKey) {\n    const modal = this.getModal(modalKey);\n    if (!modal) return this.modalNotFound(modalKey);\n    if (hasClass(modal, this.settings.stateClosed)) {\n      this.working = true;\n      setOverflowHidden(true, this.settings.selectorOverflow);\n      await openTransition(modal, this.settings);\n      this.focusTrap.init(modal);\n      focusTarget(modal, this.settings);\n      setInert(true, this.settings.selectorInert);\n      modal.dispatchEvent(new CustomEvent(this.settings.customEventPrefix + 'opened', {\n        bubbles: true\n      }));\n      this.working = false;\n      return modal;\n    } else {\n      return modal;\n    }\n  }\n\n  async close(returnFocus = true) {\n    const modal = document.querySelector(\n      `[data-${this.settings.dataModal}].${this.settings.stateOpened}`\n    );\n    if (modal) {\n      this.working = true;\n      setInert(false, this.settings.selectorInert);\n      setOverflowHidden(false, this.settings.selectorOverflow);\n      await closeTransition(modal, this.settings);\n      if (returnFocus) focusTrigger(this);\n      this.focusTrap.destroy();\n      modal.dispatchEvent(new CustomEvent(this.settings.customEventPrefix + 'closed', {\n        bubbles: true\n      }));\n      this.working = false;\n      return modal;\n    } else {\n      return modal;\n    }\n  }\n}\n"],"names":["autoInit","dataModal","dataDialog","dataOpen","dataClose","dataFocus","dataRequired","stateOpened","stateOpening","stateClosing","stateClosed","selectorInert","selectorOverflow","customEventPrefix","moveModals","ref","type","setTabindex","transition","handlerClick","event","working","trigger","target","closest","settings","preventDefault","modalKey","getAttribute","fromModal","memory","close","open","hasAttribute","handlerKeyup","key","keyCode","document","querySelector","setInitialState","obj","modals","querySelectorAll","forEach","el","classList","contains","setInert","setOverflowHidden","focusTrigger","focusTrap","destroy","removeClass","addClass","Modal","constructor","options","defaults","FocusTrap","__handlerClick","bind","__handlerKeyup","init","addEventListener","removeEventListener","getModal","modalNotFound","Promise","reject","Error","state","selectorTabindex","length","moveElement","modal","hasClass","openTransition","focusTarget","dispatchEvent","CustomEvent","bubbles","returnFocus","closeTransition"],"mappings":"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"}