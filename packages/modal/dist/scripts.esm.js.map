{"version":3,"file":"scripts.esm.js","sources":["../src/js/defaults.js","../src/js/handlers.js","../src/js/initialState.js","../index.js"],"sourcesContent":["export default {\n  autoInit: false,\n\n  // Data attributes\n  dataModal: 'modal',\n  dataDialog: 'modal-dialog',\n  dataOpen: 'modal-open',\n  dataClose: 'modal-close',\n  dataFocus: 'modal-focus',\n  dataRequired: 'modal-required',\n\n  // State classes\n  stateOpened: 'is-opened',\n  stateOpening: 'is-opening',\n  stateClosing: 'is-closing',\n  stateClosed: 'is-closed',\n\n  // Selector\n  selectorInert: null,\n  selectorOverflow: 'body',\n\n  // Feature toggles\n  customEventPrefix: 'modal:',\n  moveModals: {\n    ref: null,\n    type: null\n  },\n  setTabindex: true,\n  transition: true\n};\n","export async function handlerClick(event) {\n  // Working catch\n  if (this.working) return;\n\n  // Trigger click\n  const trigger = event.target.closest(`[data-${this.settings.dataOpen}]`);\n  if (trigger) {\n    event.preventDefault();\n    const modalKey = trigger.getAttribute(`data-${this.settings.dataOpen}`);\n    const fromModal = event.target.closest(`[data-${this.settings.dataModal}]`);\n    if (!fromModal) this.memory.trigger = trigger;\n    await this.close(!fromModal);\n    this.open(modalKey);\n    return;\n  }\n\n  // Close click\n  if (event.target.closest(`[data-${this.settings.dataClose}]`)) {\n    event.preventDefault();\n    this.close();\n    return;\n  }\n\n  // Root click\n  if (\n    event.target.hasAttribute(`data-${this.settings.dataModal}`) &&\n    !event.target.hasAttribute(`data-${this.settings.dataRequired}`)\n  ) {\n    this.close();\n    return;\n  }\n}\n\nexport function handlerKeyup(event) {\n  // Working catch\n  if (this.working) return;\n\n  if (event.key === 'Escape' || event.keyCode === 27) {\n    const target = document.querySelector(\n      `[data-${this.settings.dataModal}].${this.settings.stateOpened}`\n    );\n    if (target && !target.hasAttribute(`data-${this.settings.dataRequired}`)) {\n      this.close();\n    }\n  }\n}\n","import { addClass, removeClass } from '@vrembem/core';\nimport { setInert, setOverflowHidden } from '@vrembem/core';\nimport { focusTrigger } from '@vrembem/core';\n\nexport function setInitialState(obj) {\n  const modals = document.querySelectorAll(`[data-${obj.settings.dataModal}]`);\n  modals.forEach((el) => {\n    if (el.classList.contains(obj.settings.stateOpened)) {\n      setInert(false, obj.settings.selectorInert);\n      setOverflowHidden(false, obj.settings.selectorOverflow);\n      focusTrigger(obj);\n      obj.focusTrap.destroy();\n    }\n    removeClass(el,\n      obj.settings.stateOpened,\n      obj.settings.stateOpening,\n      obj.settings.stateClosing\n    );\n    addClass(el, obj.settings.stateClosed);\n  });\n}\n","import { hasClass } from '@vrembem/core';\nimport { setInert, setOverflowHidden, setTabindex } from '@vrembem/core';\nimport { FocusTrap, focusTarget, focusTrigger } from '@vrembem/core';\nimport { openTransition, closeTransition } from '@vrembem/core';\nimport { moveElement } from '@vrembem/core';\n\nimport defaults from './src/js/defaults';\nimport { handlerClick, handlerKeyup } from './src/js/handlers';\nimport { setInitialState } from './src/js/initialState';\n\nexport default class Modal {\n  constructor(options) {\n    this.defaults = defaults;\n    this.settings = { ...this.defaults, ...options };\n    this.working = false;\n    this.memory = {};\n    this.focusTrap = new FocusTrap();\n    this.__handlerClick = handlerClick.bind(this);\n    this.__handlerKeyup = handlerKeyup.bind(this);\n    if (this.settings.autoInit) this.init();\n  }\n\n  init(options = null) {\n    if (options) this.settings = { ...this.settings, ...options };\n    this.moveModals();\n    this.setTabindex(this.settings.setTabindex);\n    this.setInitialState();\n    document.addEventListener('click', this.__handlerClick, false);\n    document.addEventListener('touchend', this.__handlerClick, false);\n    document.addEventListener('keyup', this.__handlerKeyup, false);\n  }\n\n  destroy() {\n    this.memory = {};\n    document.removeEventListener('click', this.__handlerClick, false);\n    document.removeEventListener('touchend', this.__handlerClick, false);\n    document.removeEventListener('keyup', this.__handlerKeyup, false);\n  }\n\n  /**\n   * Helpers\n   */\n\n  getModal(modalKey) {\n    if (typeof modalKey !== 'string') return modalKey;\n    return document.querySelector(\n      `[data-${this.settings.dataModal}=\"${modalKey}\"]`\n    );\n  }\n\n  modalNotFound(key) {\n    return Promise.reject(\n      new Error(`Did not find modal with key: \"${key}\"`)\n    );\n  }\n\n  setTabindex(state = true) {\n    const selectorTabindex = `\n      [data-${this.settings.dataModal}]\n      [data-${this.settings.dataDialog}]\n    `;\n    setTabindex(state, selectorTabindex);\n  }\n\n  setInitialState() {\n    setInitialState(this);\n  }\n\n  moveModals(type = this.settings.moveModals.type, ref = this.settings.moveModals.ref) {\n    const modals = document.querySelectorAll(`[data-${this.settings.dataModal}]`);\n    if (modals.length) moveElement(modals, type, ref);\n  }\n\n  /**\n   * Change state functionality\n   */\n\n  async open(modalKey) {\n    const modal = this.getModal(modalKey);\n    if (!modal) return this.modalNotFound(modalKey);\n    if (hasClass(modal, this.settings.stateClosed)) {\n      this.working = true;\n      setOverflowHidden(true, this.settings.selectorOverflow);\n      await openTransition(modal, this.settings);\n      this.focusTrap.init(modal);\n      focusTarget(modal, this.settings);\n      setInert(true, this.settings.selectorInert);\n      modal.dispatchEvent(new CustomEvent(this.settings.customEventPrefix + 'opened', {\n        bubbles: true\n      }));\n      this.working = false;\n      return modal;\n    } else {\n      return modal;\n    }\n  }\n\n  async close(returnFocus = true) {\n    const modal = document.querySelector(\n      `[data-${this.settings.dataModal}].${this.settings.stateOpened}`\n    );\n    if (modal) {\n      this.working = true;\n      setInert(false, this.settings.selectorInert);\n      setOverflowHidden(false, this.settings.selectorOverflow);\n      await closeTransition(modal, this.settings);\n      if (returnFocus) focusTrigger(this);\n      this.focusTrap.destroy();\n      modal.dispatchEvent(new CustomEvent(this.settings.customEventPrefix + 'closed', {\n        bubbles: true\n      }));\n      this.working = false;\n      return modal;\n    } else {\n      return modal;\n    }\n  }\n}\n"],"names":["autoInit","dataModal","dataDialog","dataOpen","dataClose","dataFocus","dataRequired","stateOpened","stateOpening","stateClosing","stateClosed","selectorInert","selectorOverflow","customEventPrefix","moveModals","ref","type","setTabindex","transition","handlerClick","event","target","closest","settings","preventDefault","close","hasAttribute","working","trigger","modalKey","getAttribute","fromModal","memory","open","handlerKeyup","key","keyCode","document","querySelector","setInitialState","obj","modals","querySelectorAll","forEach","el","classList","contains","setInert","setOverflowHidden","focusTrigger","focusTrap","destroy","removeClass","addClass","Modal","options","defaults","FocusTrap","__handlerClick","bind","__handlerKeyup","init","addEventListener","removeEventListener","getModal","modalNotFound","Promise","reject","Error","state","selectorTabindex","length","moveElement","modal","hasClass","openTransition","focusTarget","dispatchEvent","CustomEvent","bubbles","returnFocus","closeTransition"],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA,eAAe;AACbA,EAAAA,QAAQ,EAAE,KADG;AAGb;AACAC,EAAAA,SAAS,EAAE,OAJE;AAKbC,EAAAA,UAAU,EAAE,cALC;AAMbC,EAAAA,QAAQ,EAAE,YANG;AAObC,EAAAA,SAAS,EAAE,aAPE;AAQbC,EAAAA,SAAS,EAAE,aARE;AASbC,EAAAA,YAAY,EAAE,gBATD;AAWb;AACAC,EAAAA,WAAW,EAAE,WAZA;AAabC,EAAAA,YAAY,EAAE,YAbD;AAcbC,EAAAA,YAAY,EAAE,YAdD;AAebC,EAAAA,WAAW,EAAE,WAfA;AAiBb;AACAC,EAAAA,aAAa,EAAE,IAlBF;AAmBbC,EAAAA,gBAAgB,EAAE,MAnBL;AAqBb;AACAC,EAAAA,iBAAiB,EAAE,QAtBN;AAuBbC,EAAAA,UAAU,EAAE;AACVC,IAAAA,GAAG,EAAE,IADK;AAEVC,IAAAA,IAAI,EAAE;AAFI,GAvBC;AA2BbC,EAAAA,WAAW,EAAE,IA3BA;AA4BbC,EAAAA,UAAU,EAAE;AA5BC,CAAf;;ICAsBC,YAAtB,YAAsBA,YAAtB,CAAmCC,KAAnC;AAAA,MAA0C;AAAA;;AAAA,iBAEpC,IAFoC;;AAAA;AAAA;;AAgBxC;AACA,UAAIA,KAAK,CAACC,MAAN,CAAaC,OAAb,YAA8B,OAAKC,QAAL,CAAcnB,SAA5C,OAAJ,EAA+D;AAC7DgB,QAAAA,KAAK,CAACI,cAAN;;AACA,eAAKC,KAAL;;AACA;AACD,OArBuC;;;AAAA,UAyBtCL,KAAK,CAACC,MAAN,CAAaK,YAAb,WAAkC,OAAKH,QAAL,CAActB,SAAhD,KACA,CAACmB,KAAK,CAACC,MAAN,CAAaK,YAAb,WAAkC,OAAKH,QAAL,CAAcjB,YAAhD,CA1BqC;AA4BtC,eAAKmB,KAAL;AA5BsC;AAAA;;AACxC;AACA,QAAI,OAAKE,OAAT,EAAkB,yBAFsB;;AAKxC,QAAMC,OAAO,GAAGR,KAAK,CAACC,MAAN,CAAaC,OAAb,YAA8B,OAAKC,QAAL,CAAcpB,QAA5C,OAAhB;;AALwC;AAAA,UAMpCyB,OANoC;AAOtCR,QAAAA,KAAK,CAACI,cAAN;AACA,YAAMK,QAAQ,GAAGD,OAAO,CAACE,YAAR,WAA6B,OAAKP,QAAL,CAAcpB,QAA3C,CAAjB;AACA,YAAM4B,SAAS,GAAGX,KAAK,CAACC,MAAN,CAAaC,OAAb,YAA8B,OAAKC,QAAL,CAActB,SAA5C,OAAlB;AACA,YAAI,CAAC8B,SAAL,EAAgB,OAAKC,MAAL,CAAYJ,OAAZ,GAAsBA,OAAtB;AAVsB,+BAWhC,OAAKH,KAAL,CAAW,CAACM,SAAZ,CAXgC;AAYtC,iBAAKE,IAAL,CAAUJ,QAAV;;AAZsC;AAAA;AAAA;AAAA;;AAAA;AA+BzC,GA/BD;AAAA;AAAA;AAAA;AAiCA,AAAO,SAASK,YAAT,CAAsBd,KAAtB,EAA6B;AAClC;AACA,MAAI,KAAKO,OAAT,EAAkB;;AAElB,MAAIP,KAAK,CAACe,GAAN,KAAc,QAAd,IAA0Bf,KAAK,CAACgB,OAAN,KAAkB,EAAhD,EAAoD;AAClD,QAAMf,MAAM,GAAGgB,QAAQ,CAACC,aAAT,YACJ,KAAKf,QAAL,CAActB,SADV,UACwB,KAAKsB,QAAL,CAAchB,WADtC,CAAf;;AAGA,QAAIc,MAAM,IAAI,CAACA,MAAM,CAACK,YAAP,WAA4B,KAAKH,QAAL,CAAcjB,YAA1C,CAAf,EAA0E;AACxE,WAAKmB,KAAL;AACD;AACF;AACF;;ACzCM,SAASc,eAAT,CAAyBC,GAAzB,EAA8B;AACnC,MAAMC,MAAM,GAAGJ,QAAQ,CAACK,gBAAT,YAAmCF,GAAG,CAACjB,QAAJ,CAAatB,SAAhD,OAAf;AACAwC,EAAAA,MAAM,CAACE,OAAP,CAAe,UAACC,EAAD,EAAQ;AACrB,QAAIA,EAAE,CAACC,SAAH,CAAaC,QAAb,CAAsBN,GAAG,CAACjB,QAAJ,CAAahB,WAAnC,CAAJ,EAAqD;AACnDwC,MAAAA,QAAQ,CAAC,KAAD,EAAQP,GAAG,CAACjB,QAAJ,CAAaZ,aAArB,CAAR;AACAqC,MAAAA,iBAAiB,CAAC,KAAD,EAAQR,GAAG,CAACjB,QAAJ,CAAaX,gBAArB,CAAjB;AACAqC,MAAAA,YAAY,CAACT,GAAD,CAAZ;AACAA,MAAAA,GAAG,CAACU,SAAJ,CAAcC,OAAd;AACD;;AACDC,IAAAA,WAAW,CAACR,EAAD,EACTJ,GAAG,CAACjB,QAAJ,CAAahB,WADJ,EAETiC,GAAG,CAACjB,QAAJ,CAAaf,YAFJ,EAGTgC,GAAG,CAACjB,QAAJ,CAAad,YAHJ,CAAX;AAKA4C,IAAAA,QAAQ,CAACT,EAAD,EAAKJ,GAAG,CAACjB,QAAJ,CAAab,WAAlB,CAAR;AACD,GAbD;AAcD;;ICVoB4C;AACnB,iBAAYC,OAAZ,EAAqB;AACnB,SAAKC,QAAL,GAAgBA,QAAhB;AACA,SAAKjC,QAAL,gBAAqB,KAAKiC,QAA1B,EAAuCD,OAAvC;AACA,SAAK5B,OAAL,GAAe,KAAf;AACA,SAAKK,MAAL,GAAc,EAAd;AACA,SAAKkB,SAAL,GAAiB,IAAIO,SAAJ,EAAjB;AACA,SAAKC,cAAL,GAAsBvC,YAAY,CAACwC,IAAb,CAAkB,IAAlB,CAAtB;AACA,SAAKC,cAAL,GAAsB1B,YAAY,CAACyB,IAAb,CAAkB,IAAlB,CAAtB;AACA,QAAI,KAAKpC,QAAL,CAAcvB,QAAlB,EAA4B,KAAK6D,IAAL;AAC7B;;;;SAEDA,OAAA,cAAKN,OAAL,EAAqB;AAAA,QAAhBA,OAAgB;AAAhBA,MAAAA,OAAgB,GAAN,IAAM;AAAA;;AACnB,QAAIA,OAAJ,EAAa,KAAKhC,QAAL,gBAAqB,KAAKA,QAA1B,EAAuCgC,OAAvC;AACb,SAAKzC,UAAL;AACA,SAAKG,WAAL,CAAiB,KAAKM,QAAL,CAAcN,WAA/B;AACA,SAAKsB,eAAL;AACAF,IAAAA,QAAQ,CAACyB,gBAAT,CAA0B,OAA1B,EAAmC,KAAKJ,cAAxC,EAAwD,KAAxD;AACArB,IAAAA,QAAQ,CAACyB,gBAAT,CAA0B,UAA1B,EAAsC,KAAKJ,cAA3C,EAA2D,KAA3D;AACArB,IAAAA,QAAQ,CAACyB,gBAAT,CAA0B,OAA1B,EAAmC,KAAKF,cAAxC,EAAwD,KAAxD;AACD;;SAEDT,UAAA,mBAAU;AACR,SAAKnB,MAAL,GAAc,EAAd;AACAK,IAAAA,QAAQ,CAAC0B,mBAAT,CAA6B,OAA7B,EAAsC,KAAKL,cAA3C,EAA2D,KAA3D;AACArB,IAAAA,QAAQ,CAAC0B,mBAAT,CAA6B,UAA7B,EAAyC,KAAKL,cAA9C,EAA8D,KAA9D;AACArB,IAAAA,QAAQ,CAAC0B,mBAAT,CAA6B,OAA7B,EAAsC,KAAKH,cAA3C,EAA2D,KAA3D;AACD;AAED;;;;;SAIAI,WAAA,kBAASnC,QAAT,EAAmB;AACjB,QAAI,OAAOA,QAAP,KAAoB,QAAxB,EAAkC,OAAOA,QAAP;AAClC,WAAOQ,QAAQ,CAACC,aAAT,YACI,KAAKf,QAAL,CAActB,SADlB,WACgC4B,QADhC,SAAP;AAGD;;SAEDoC,gBAAA,uBAAc9B,GAAd,EAAmB;AACjB,WAAO+B,OAAO,CAACC,MAAR,CACL,IAAIC,KAAJ,qCAA2CjC,GAA3C,QADK,CAAP;AAGD;;SAEDlB,cAAA,uBAAYoD,KAAZ,EAA0B;AAAA,QAAdA,KAAc;AAAdA,MAAAA,KAAc,GAAN,IAAM;AAAA;;AACxB,QAAMC,gBAAgB,sBACZ,KAAK/C,QAAL,CAActB,SADF,uBAEZ,KAAKsB,QAAL,CAAcrB,UAFF,YAAtB;;AAIAe,IAAAA,WAAW,CAACoD,KAAD,EAAQC,gBAAR,CAAX;AACD;;SAED/B,kBAAA,6BAAkB;AAChBA,IAAAA,eAAe,CAAC,IAAD,CAAf;AACD;;SAEDzB,aAAA,oBAAWE,IAAX,EAAiDD,GAAjD,EAAqF;AAAA,QAA1EC,IAA0E;AAA1EA,MAAAA,IAA0E,GAAnE,KAAKO,QAAL,CAAcT,UAAd,CAAyBE,IAA0C;AAAA;;AAAA,QAApCD,GAAoC;AAApCA,MAAAA,GAAoC,GAA9B,KAAKQ,QAAL,CAAcT,UAAd,CAAyBC,GAAK;AAAA;;AACnF,QAAM0B,MAAM,GAAGJ,QAAQ,CAACK,gBAAT,YAAmC,KAAKnB,QAAL,CAActB,SAAjD,OAAf;AACA,QAAIwC,MAAM,CAAC8B,MAAX,EAAmBC,WAAW,CAAC/B,MAAD,EAASzB,IAAT,EAAeD,GAAf,CAAX;AACpB;AAED;;;;;SAIMkB,qBAAKJ;QAAU;AAAA,mBACL,IADK;;AACnB,UAAM4C,KAAK,GAAG,OAAKT,QAAL,CAAcnC,QAAd,CAAd;;AACA,UAAI,CAAC4C,KAAL,EAAY,uBAAO,OAAKR,aAAL,CAAmBpC,QAAnB,CAAP;;AACZ,UAAI6C,QAAQ,CAACD,KAAD,EAAQ,OAAKlD,QAAL,CAAcb,WAAtB,CAAZ,EAAgD;AAC9C,eAAKiB,OAAL,GAAe,IAAf;AACAqB,QAAAA,iBAAiB,CAAC,IAAD,EAAO,OAAKzB,QAAL,CAAcX,gBAArB,CAAjB;AAF8C,+BAGxC+D,cAAc,CAACF,KAAD,EAAQ,OAAKlD,QAAb,CAH0B;AAI9C,iBAAK2B,SAAL,CAAeW,IAAf,CAAoBY,KAApB;;AACAG,UAAAA,WAAW,CAACH,KAAD,EAAQ,OAAKlD,QAAb,CAAX;AACAwB,UAAAA,QAAQ,CAAC,IAAD,EAAO,OAAKxB,QAAL,CAAcZ,aAArB,CAAR;AACA8D,UAAAA,KAAK,CAACI,aAAN,CAAoB,IAAIC,WAAJ,CAAgB,OAAKvD,QAAL,CAAcV,iBAAd,GAAkC,QAAlD,EAA4D;AAC9EkE,YAAAA,OAAO,EAAE;AADqE,WAA5D,CAApB;AAGA,iBAAKpD,OAAL,GAAe,KAAf;AACA,iBAAO8C,KAAP;AAX8C;AAY/C,OAZD,MAYO;AACL,+BAAOA,KAAP;AACD;AACF;;;;;SAEKhD,uBAAMuD;QAAAA;AAAAA,MAAAA,cAAc;;;QAAM;AAAA,mBAEnB,IAFmB;;AAC9B,UAAMP,KAAK,GAAGpC,QAAQ,CAACC,aAAT,YACH,OAAKf,QAAL,CAActB,SADX,UACyB,OAAKsB,QAAL,CAAchB,WADvC,CAAd;;AAGA,UAAIkE,KAAJ,EAAW;AACT,eAAK9C,OAAL,GAAe,IAAf;AACAoB,QAAAA,QAAQ,CAAC,KAAD,EAAQ,OAAKxB,QAAL,CAAcZ,aAAtB,CAAR;AACAqC,QAAAA,iBAAiB,CAAC,KAAD,EAAQ,OAAKzB,QAAL,CAAcX,gBAAtB,CAAjB;AAHS,+BAIHqE,eAAe,CAACR,KAAD,EAAQ,OAAKlD,QAAb,CAJZ;AAKT,cAAIyD,WAAJ,EAAiB/B,YAAY,QAAZ;;AACjB,iBAAKC,SAAL,CAAeC,OAAf;;AACAsB,UAAAA,KAAK,CAACI,aAAN,CAAoB,IAAIC,WAAJ,CAAgB,OAAKvD,QAAL,CAAcV,iBAAd,GAAkC,QAAlD,EAA4D;AAC9EkE,YAAAA,OAAO,EAAE;AADqE,WAA5D,CAApB;AAGA,iBAAKpD,OAAL,GAAe,KAAf;AACA,iBAAO8C,KAAP;AAXS;AAYV,OAZD,MAYO;AACL,+BAAOA,KAAP;AACD;AACF;;;;;;;;;;"}