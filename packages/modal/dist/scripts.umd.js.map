{"version":3,"file":"scripts.umd.js","sources":["../src/js/defaults.js","../src/js/handlers.js","../src/js/initialState.js","../index.js"],"sourcesContent":["export default {\n  autoInit: false,\n\n  // Data attributes\n  dataModal: 'modal',\n  dataDialog: 'modal-dialog',\n  dataOpen: 'modal-open',\n  dataClose: 'modal-close',\n  dataFocus: 'modal-focus',\n  dataRequired: 'modal-required',\n\n  // State classes\n  stateOpened: 'is-opened',\n  stateOpening: 'is-opening',\n  stateClosing: 'is-closing',\n  stateClosed: 'is-closed',\n\n  // Selector\n  selectorInert: null,\n  selectorOverflow: 'body',\n\n  // Feature toggles\n  customEventPrefix: 'modal:',\n  moveModals: {\n    ref: null,\n    type: null\n  },\n  setTabindex: true,\n  transition: true\n};\n","export async function handlerClick(event) {\n  // Working catch\n  if (this.working) return;\n\n  // Trigger click\n  const trigger = event.target.closest(`[data-${this.settings.dataOpen}]`);\n  if (trigger) {\n    event.preventDefault();\n    const modalKey = trigger.getAttribute(`data-${this.settings.dataOpen}`);\n    const fromModal = event.target.closest(`[data-${this.settings.dataModal}]`);\n    if (!fromModal) this.memory.trigger = trigger;\n    await this.close(!fromModal);\n    this.open(modalKey);\n    return;\n  }\n\n  // Close click\n  if (event.target.closest(`[data-${this.settings.dataClose}]`)) {\n    event.preventDefault();\n    this.close();\n    return;\n  }\n\n  // Root click\n  if (\n    event.target.hasAttribute(`data-${this.settings.dataModal}`) &&\n    !event.target.hasAttribute(`data-${this.settings.dataRequired}`)\n  ) {\n    this.close();\n    return;\n  }\n}\n\nexport function handlerKeyup(event) {\n  // Working catch\n  if (this.working) return;\n\n  if (event.key === 'Escape' || event.keyCode === 27) {\n    const target = document.querySelector(\n      `[data-${this.settings.dataModal}].${this.settings.stateOpened}`\n    );\n    if (target && !target.hasAttribute(`data-${this.settings.dataRequired}`)) {\n      this.close();\n    }\n  }\n}\n","import { addClass, removeClass } from '@vrembem/core/index';\nimport { setInert, setOverflowHidden } from '@vrembem/core/index';\nimport { focusTrigger } from '@vrembem/core/index';\n\nexport function setInitialState(obj) {\n  const modals = document.querySelectorAll(`[data-${obj.settings.dataModal}]`);\n  modals.forEach((el) => {\n    if (el.classList.contains(obj.settings.stateOpened)) {\n      setInert(false, obj.settings.selectorInert);\n      setOverflowHidden(false, obj.settings.selectorOverflow);\n      focusTrigger(obj);\n      obj.focusTrap.destroy();\n    }\n    removeClass(el,\n      obj.settings.stateOpened,\n      obj.settings.stateOpening,\n      obj.settings.stateClosing\n    );\n    addClass(el, obj.settings.stateClosed);\n  });\n}\n","import { hasClass } from '@vrembem/core/index';\nimport { setInert, setOverflowHidden, setTabindex } from '@vrembem/core/index';\nimport { FocusTrap, focusTarget, focusTrigger } from '@vrembem/core/index';\nimport { openTransition, closeTransition } from '@vrembem/core/index';\nimport { moveElement } from '@vrembem/core/index';\n\nimport defaults from './src/js/defaults';\nimport { handlerClick, handlerKeyup } from './src/js/handlers';\nimport { setInitialState } from './src/js/initialState';\n\nexport default class Modal {\n  constructor(options) {\n    this.defaults = defaults;\n    this.settings = { ...this.defaults, ...options };\n    this.working = false;\n    this.memory = {};\n    this.focusTrap = new FocusTrap();\n    this.__handlerClick = handlerClick.bind(this);\n    this.__handlerKeyup = handlerKeyup.bind(this);\n    if (this.settings.autoInit) this.init();\n  }\n\n  init(options = null) {\n    if (options) this.settings = { ...this.settings, ...options };\n    this.moveModals();\n    this.setTabindex(this.settings.setTabindex);\n    this.setInitialState();\n    document.addEventListener('click', this.__handlerClick, false);\n    document.addEventListener('touchend', this.__handlerClick, false);\n    document.addEventListener('keyup', this.__handlerKeyup, false);\n  }\n\n  destroy() {\n    this.memory = {};\n    document.removeEventListener('click', this.__handlerClick, false);\n    document.removeEventListener('touchend', this.__handlerClick, false);\n    document.removeEventListener('keyup', this.__handlerKeyup, false);\n  }\n\n  /**\n   * Helpers\n   */\n\n  getModal(modalKey) {\n    if (typeof modalKey !== 'string') return modalKey;\n    return document.querySelector(\n      `[data-${this.settings.dataModal}=\"${modalKey}\"]`\n    );\n  }\n\n  modalNotFound(key) {\n    return Promise.reject(\n      new Error(`Did not find modal with key: \"${key}\"`)\n    );\n  }\n\n  setTabindex(state = true) {\n    const selectorTabindex = `\n      [data-${this.settings.dataModal}]\n      [data-${this.settings.dataDialog}]\n    `;\n    setTabindex(state, selectorTabindex);\n  }\n\n  setInitialState() {\n    setInitialState(this);\n  }\n\n  moveModals(type = this.settings.moveModals.type, ref = this.settings.moveModals.ref) {\n    const modals = document.querySelectorAll(`[data-${this.settings.dataModal}]`);\n    if (modals.length) moveElement(modals, type, ref);\n  }\n\n  /**\n   * Change state functionality\n   */\n\n  async open(modalKey) {\n    const modal = this.getModal(modalKey);\n    if (!modal) return this.modalNotFound(modalKey);\n    if (hasClass(modal, this.settings.stateClosed)) {\n      this.working = true;\n      setOverflowHidden(true, this.settings.selectorOverflow);\n      await openTransition(modal, this.settings);\n      this.focusTrap.init(modal);\n      focusTarget(modal, this.settings);\n      setInert(true, this.settings.selectorInert);\n      modal.dispatchEvent(new CustomEvent(this.settings.customEventPrefix + 'opened', {\n        bubbles: true\n      }));\n      this.working = false;\n      return modal;\n    } else {\n      return modal;\n    }\n  }\n\n  async close(returnFocus = true) {\n    const modal = document.querySelector(\n      `[data-${this.settings.dataModal}].${this.settings.stateOpened}`\n    );\n    if (modal) {\n      this.working = true;\n      setInert(false, this.settings.selectorInert);\n      setOverflowHidden(false, this.settings.selectorOverflow);\n      await closeTransition(modal, this.settings);\n      if (returnFocus) focusTrigger(this);\n      this.focusTrap.destroy();\n      modal.dispatchEvent(new CustomEvent(this.settings.customEventPrefix + 'closed', {\n        bubbles: true\n      }));\n      this.working = false;\n      return modal;\n    } else {\n      return modal;\n    }\n  }\n}\n"],"names":["autoInit","dataModal","dataDialog","dataOpen","dataClose","dataFocus","dataRequired","stateOpened","stateOpening","stateClosing","stateClosed","selectorInert","selectorOverflow","customEventPrefix","moveModals","ref","type","setTabindex","transition","handlerClick","event","target","closest","settings","preventDefault","close","hasAttribute","working","trigger","modalKey","getAttribute","fromModal","memory","open","handlerKeyup","key","keyCode","document","querySelector","setInitialState","obj","modals","querySelectorAll","forEach","el","classList","contains","setInert","setOverflowHidden","focusTrigger","focusTrap","destroy","removeClass","addClass","Modal","options","defaults","FocusTrap","__handlerClick","bind","__handlerKeyup","init","addEventListener","removeEventListener","getModal","modalNotFound","Promise","reject","Error","state","selectorTabindex","length","moveElement","modal","hasClass","openTransition","focusTarget","dispatchEvent","CustomEvent","bubbles","returnFocus","closeTransition"],"mappings":"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"}