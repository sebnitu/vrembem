{"version":3,"file":"scripts.js","sources":["../src/js/defaults.js","../src/js/switchTo.js","../src/js/breakpoint.js","../src/js/handlers.js","../src/js/state.js","../index.js"],"sourcesContent":["import { breakpoints } from '@vrembem/core/index';\n\nexport default {\n  autoInit: false,\n\n  // Data attributes\n  dataDrawer: 'drawer',\n  dataDialog: 'drawer-dialog',\n  dataToggle: 'drawer-toggle',\n  dataOpen: 'drawer-open',\n  dataClose: 'drawer-close',\n  dataBreakpoint: 'drawer-breakpoint',\n  dataFocus: 'drawer-focus',\n\n  // State classes\n  stateOpened: 'is-opened',\n  stateOpening: 'is-opening',\n  stateClosing: 'is-closing',\n  stateClosed: 'is-closed',\n\n  // Classes\n  classModal: 'drawer_modal',\n\n  // Selectors\n  selectorInert: null,\n  selectorOverflow: null,\n\n  // Feature toggles\n  breakpoints: breakpoints,\n  customEventPrefix: 'drawer:',\n  stateSave: true,\n  stateKey: 'DrawerState',\n  setTabindex: true,\n  transition: true\n};\n","import { addClass, hasClass, removeClass } from '@vrembem/core/index';\nimport { setInert, setOverflowHidden } from '@vrembem/core/index';\n\nexport async function switchToModal(drawerKey, obj) {\n  // Initial guards\n  const drawer = obj.getDrawer(drawerKey);\n  if (!drawer) return obj.drawerNotFound(drawerKey);\n  if (hasClass(drawer, obj.settings.classModal)) return;\n\n  // Enable modal state\n  addClass(drawer, obj.settings.classModal);\n  addClass(drawer, obj.settings.stateClosed);\n  removeClass(drawer, obj.settings.stateOpened);\n\n  // Dispatch custom event\n  drawer.dispatchEvent(new CustomEvent(obj.settings.customEventPrefix + 'toModal', {\n    bubbles: true\n  }));\n  return drawer;\n}\n\nexport async function switchToDefault(drawerKey, obj) {\n  // Initial guards\n  const drawer = obj.getDrawer(drawerKey);\n  if (!drawer) return obj.drawerNotFound(drawerKey);\n  if (!hasClass(drawer, obj.settings.classModal)) return;\n\n  // Tear down modal state\n  setInert(false, obj.settings.selectorInert);\n  setOverflowHidden(false, obj.settings.selectorOverflow);\n  removeClass(drawer, obj.settings.classModal);\n  obj.focusTrap.destroy();\n\n  // Restore drawers saved state\n  drawerKey = drawer.getAttribute(`data-${obj.settings.dataDrawer}`);\n  const drawerState = obj.state[drawerKey];\n  if (drawerState == obj.settings.stateOpened) {\n    addClass(drawer, obj.settings.stateOpened);\n    removeClass(drawer, obj.settings.stateClosed);\n  }\n\n  // Dispatch custom event\n  drawer.dispatchEvent(new CustomEvent(obj.settings.customEventPrefix + 'toDefault', {\n    bubbles: true\n  }));\n  return drawer;\n}\n","import { switchToDefault, switchToModal } from './switchTo';\n\nexport class Breakpoint {\n  constructor(parent) {\n    this.mediaQueryLists = [];\n    this.parent = parent;\n    this.__check = this.check.bind(this);\n  }\n\n  init() {\n    const drawers = document.querySelectorAll(`[data-${this.parent.settings.dataBreakpoint}]`);\n    drawers.forEach((drawer) => {\n      const id = drawer.getAttribute(`data-${this.parent.settings.dataDrawer}`);\n      const key = drawer.getAttribute(`data-${this.parent.settings.dataBreakpoint}`);\n      const bp = this.parent.settings.breakpoints[key] ? this.parent.settings.breakpoints[key] : key;\n      const mql = window.matchMedia('(min-width:' + bp + ')');\n      this.match(mql, drawer);\n      mql.addListener(this.__check);\n      this.mediaQueryLists.push({\n        'mql': mql,\n        'drawer': id\n      });\n    });\n  }\n\n  destroy() {\n    if (this.mediaQueryLists && this.mediaQueryLists.length) {\n      this.mediaQueryLists.forEach((item) => {\n        item.mql.removeListener(this.__check);\n      });\n    }\n    this.mediaQueryLists = null;\n  }\n\n  check(event = null) {\n    if (this.mediaQueryLists && this.mediaQueryLists.length) {\n      this.mediaQueryLists.forEach((item) => {\n        // If an event is passed, filter out drawers that don't match the query\n        // If event is null, run all drawers through match\n        let filter = (event) ? event.media == item.mql.media : true;\n        if (!filter) return;\n        const drawer = document.querySelector(\n          `[data-${this.parent.settings.dataDrawer}=\"${item.drawer}\"]`\n        );\n        if (drawer) this.match(item.mql, drawer);\n      });\n      document.dispatchEvent(new CustomEvent(this.parent.settings.customEventPrefix + 'breakpoint', {\n        bubbles: true\n      }));\n    }\n  }\n\n  match(mql, drawer) {\n    if (mql.matches) {\n      switchToDefault(drawer, this.parent);\n    } else {\n      switchToModal(drawer, this.parent);\n    }\n  }\n}\n","export function handlerClick(event) {\n  // Working catch\n  if (this.working) return;\n\n  // Toggle data trigger\n  let trigger = event.target.closest(`[data-${this.settings.dataToggle}]`);\n  if (trigger) {\n    const selector = trigger.getAttribute(`data-${this.settings.dataToggle}`);\n    this.memory.trigger = trigger;\n    this.toggle(selector);\n    event.preventDefault();\n    return;\n  }\n\n  // Open data trigger\n  trigger = event.target.closest(`[data-${this.settings.dataOpen}]`);\n  if (trigger) {\n    const selector = trigger.getAttribute(`data-${this.settings.dataOpen}`);\n    this.memory.trigger = trigger;\n    this.open(selector);\n    event.preventDefault();\n    return;\n  }\n\n  // Close data trigger\n  trigger = event.target.closest(`[data-${this.settings.dataClose}]`);\n  if (trigger) {\n    const selector = trigger.getAttribute(`data-${this.settings.dataClose}`);\n    if (selector) {\n      this.memory.trigger = trigger;\n      this.close(selector);\n    } else {\n      const target = event.target.closest(`[data-${this.settings.dataDrawer}]`);\n      if (target) this.close(target);\n    }\n    event.preventDefault();\n    return;\n  }\n\n  // Screen modal trigger\n  if (event.target.hasAttribute(`data-${this.settings.dataDrawer}`)) {\n    this.close(event.target);\n    return;\n  }\n}\n\nexport function handlerKeyup(event) {\n  // Working catch\n  if (this.working) return;\n\n  if (event.keyCode == 27) {\n    const target = document.querySelector(\n      `.${this.settings.classModal}.${this.settings.stateOpened}`\n    );\n    if (target) {\n      this.close(target);\n    }\n  }\n}\n","import { addClass, hasClass, removeClass } from '@vrembem/core/index';\n\nexport function stateSet(settings) {\n  // If save state is disabled\n  if (!settings.stateSave)\n    return stateClear(settings);\n\n  // If there isn't an existing state to set\n  if (!localStorage.getItem(settings.stateKey))\n    return stateSave(null, settings);\n\n  // Set the existing state\n  const state = JSON.parse(localStorage.getItem(settings.stateKey));\n  Object.keys(state).forEach((key) => {\n    const item = document.querySelector(\n      `[data-${settings.dataDrawer}=\"${key}\"]`\n    );\n    if (!item) return;\n    (state[key] == settings.stateOpened) ?\n      addClass(item, settings.stateOpened) :\n      removeClass(item, settings.stateOpened);\n  });\n  return state;\n}\n\nexport function stateSave(target, settings) {\n  // If save state is disabled\n  if (!settings.stateSave)\n    return stateClear(settings);\n\n  // Get the currently saved object if it exists\n  const state = (localStorage.getItem(settings.stateKey)) ?\n    JSON.parse(localStorage.getItem(settings.stateKey)) : {};\n\n  // Are we saving a single target or the entire suite?\n  const drawers = (target) ? [target] :\n    document.querySelectorAll(`[data-${settings.dataDrawer}]`);\n\n  // Loop through drawers and save their states\n  drawers.forEach((el) => {\n    if (hasClass(el, settings.classModal)) return;\n    const drawerKey = el.getAttribute(`data-${settings.dataDrawer}`);\n    state[drawerKey] = (hasClass(el, settings.stateOpened)) ?\n      settings.stateOpened : settings.stateClosed;\n  });\n\n  // Save to localStorage and return the state\n  localStorage.setItem(settings.stateKey, JSON.stringify(state));\n  return state;\n}\n\nexport function stateClear(settings) {\n  if (localStorage.getItem(settings.stateKey)) {\n    localStorage.removeItem(settings.stateKey);\n  }\n  return {};\n}\n","import { hasClass } from '@vrembem/core/index';\nimport { setInert, setOverflowHidden, setTabindex } from '@vrembem/core/index';\nimport { FocusTrap, focusTarget, focusTrigger } from '@vrembem/core/index';\nimport { openTransition, closeTransition } from '@vrembem/core/index';\n\nimport defaults from './src/js/defaults';\nimport { Breakpoint } from './src/js/breakpoint';\nimport { handlerClick, handlerKeyup } from './src/js/handlers';\nimport { stateClear, stateSave, stateSet } from './src/js/state';\nimport { switchToDefault, switchToModal } from './src/js/switchTo';\n\nexport default class Drawer {\n  constructor(options) {\n    this.defaults = defaults;\n    this.settings = { ...this.defaults, ...options };\n    this.working = false;\n    this.memory = {};\n    this.state = {};\n    this.focusTrap = new FocusTrap();\n    this.breakpoint = new Breakpoint(this);\n    this.__handlerClick = handlerClick.bind(this);\n    this.__handlerKeyup = handlerKeyup.bind(this);\n    if (this.settings.autoInit) this.init();\n  }\n\n  init(options = null) {\n    if (options) this.settings = { ...this.settings, ...options };\n    this.stateSet();\n    this.setTabindex(this.settings.setTabindex);\n    this.breakpoint.init();\n    document.addEventListener('click', this.__handlerClick, false);\n    document.addEventListener('touchend', this.__handlerClick, false);\n    document.addEventListener('keyup', this.__handlerKeyup, false);\n  }\n\n  destroy() {\n    this.breakpoint.destroy();\n    this.memory = {};\n    this.state = {};\n    localStorage.removeItem(this.settings.stateKey);\n    document.removeEventListener('click', this.__handlerClick, false);\n    document.removeEventListener('touchend', this.__handlerClick, false);\n    document.removeEventListener('keyup', this.__handlerKeyup, false);\n  }\n\n  /**\n   * Helpers\n   */\n\n  getDrawer(drawerKey) {\n    if (typeof drawerKey !== 'string') return drawerKey;\n    return document.querySelector(\n      `[data-${this.settings.dataDrawer}=\"${drawerKey}\"]`\n    );\n  }\n\n  drawerNotFound(key) {\n    return Promise.reject(\n      new Error(`Did not find drawer with key: \"${key}\"`)\n    );\n  }\n\n  setTabindex(state = true) {\n    const selectorTabindex = `\n      [data-${this.settings.dataDrawer}]\n      [data-${this.settings.dataDialog}]\n    `;\n    setTabindex(state, selectorTabindex);\n  }\n\n  /**\n   * Save state functionality\n   */\n\n  stateSet() {\n    this.state = stateSet(this.settings);\n  }\n\n  stateSave(target = null) {\n    this.state = stateSave(target, this.settings);\n  }\n\n  stateClear() {\n    this.state = stateClear(this.settings);\n  }\n\n  /**\n   * SwitchTo functionality\n   */\n\n  switchToDefault(drawerKey) {\n    return switchToDefault(drawerKey, this);\n  }\n\n  switchToModal(drawerKey) {\n    return switchToModal(drawerKey, this);\n  }\n\n  /**\n   * Change state functionality\n   */\n\n  async toggle(drawerKey) {\n    const drawer = this.getDrawer(drawerKey);\n    if (!drawer) return this.drawerNotFound(drawerKey);\n    const isOpen = hasClass(drawer, this.settings.stateOpened);\n    if (!isOpen) {\n      return this.open(drawer);\n    } else {\n      return this.close(drawer);\n    }\n  }\n\n  async open(drawerKey) {\n    const drawer = this.getDrawer(drawerKey);\n    if (!drawer) return this.drawerNotFound(drawerKey);\n    if (!hasClass(drawer, this.settings.stateOpened)) {\n      this.working = true;\n      const isModal = hasClass(drawer, this.settings.classModal);\n      if (isModal) {\n        setOverflowHidden(true, this.settings.selectorOverflow);\n      }\n      await openTransition(drawer, this.settings);\n      this.stateSave(drawer);\n      if (isModal) {\n        this.focusTrap.init(drawer);\n        setInert(true, this.settings.selectorInert);\n      }\n      focusTarget(drawer, this.settings);\n      drawer.dispatchEvent(new CustomEvent(this.settings.customEventPrefix + 'opened', {\n        bubbles: true\n      }));\n      this.working = false;\n      return drawer;\n    } else {\n      focusTarget(drawer, this.settings);\n      return drawer;\n    }\n  }\n\n  async close(drawerKey) {\n    const drawer = this.getDrawer(drawerKey);\n    if (!drawer) return this.drawerNotFound(drawerKey);\n    if (hasClass(drawer, this.settings.stateOpened)) {\n      this.working = true;\n      if (hasClass(drawer, this.settings.classModal)) {\n        setInert(false, this.settings.selectorInert);\n        setOverflowHidden(false, this.settings.selectorOverflow);\n      }\n      await closeTransition(drawer, this.settings);\n      this.stateSave(drawer);\n      focusTrigger(this);\n      this.focusTrap.destroy();\n      drawer.dispatchEvent(new CustomEvent(this.settings.customEventPrefix + 'closed', {\n        bubbles: true\n      }));\n      this.working = false;\n      return drawer;\n    } else {\n      return drawer;\n    }\n  }\n}\n"],"names":["autoInit","dataDrawer","dataDialog","dataToggle","dataOpen","dataClose","dataBreakpoint","dataFocus","stateOpened","stateOpening","stateClosing","stateClosed","classModal","selectorInert","selectorOverflow","breakpoints","customEventPrefix","stateSave","stateKey","setTabindex","transition","switchToDefault","drawerKey","obj","drawer","getDrawer","drawerNotFound","hasClass","settings","setInert","setOverflowHidden","removeClass","focusTrap","destroy","getAttribute","drawerState","state","addClass","dispatchEvent","CustomEvent","bubbles","switchToModal","Breakpoint","parent","mediaQueryLists","__check","check","bind","init","drawers","document","querySelectorAll","forEach","id","key","bp","mql","window","matchMedia","match","addListener","push","length","item","removeListener","event","filter","media","querySelector","matches","handlerClick","working","trigger","target","closest","selector","memory","toggle","preventDefault","open","close","hasAttribute","handlerKeyup","keyCode","stateSet","stateClear","localStorage","getItem","JSON","parse","Object","keys","el","setItem","stringify","removeItem","Drawer","options","defaults","FocusTrap","breakpoint","__handlerClick","__handlerKeyup","addEventListener","removeEventListener","Promise","reject","Error","selectorTabindex","isOpen","isModal","openTransition","focusTarget","closeTransition","focusTrigger"],"mappings":"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"}