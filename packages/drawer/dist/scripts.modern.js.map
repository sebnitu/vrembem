{"version":3,"file":"scripts.modern.js","sources":["../src/js/defaults.js","../src/js/switchTo.js","../src/js/breakpoint.js","../src/js/handlers.js","../src/js/state.js","../index.js"],"sourcesContent":["import { breakpoints } from '@vrembem/core/index';\n\nexport default {\n  autoInit: false,\n\n  // Data attributes\n  dataDrawer: 'drawer',\n  dataDialog: 'drawer-dialog',\n  dataToggle: 'drawer-toggle',\n  dataOpen: 'drawer-open',\n  dataClose: 'drawer-close',\n  dataBreakpoint: 'drawer-breakpoint',\n  dataFocus: 'drawer-focus',\n\n  // State classes\n  stateOpened: 'is-opened',\n  stateOpening: 'is-opening',\n  stateClosing: 'is-closing',\n  stateClosed: 'is-closed',\n\n  // Classes\n  classModal: 'drawer_modal',\n\n  // Selectors\n  selectorInert: null,\n  selectorOverflow: null,\n\n  // Feature toggles\n  breakpoints: breakpoints,\n  customEventPrefix: 'drawer:',\n  stateSave: true,\n  stateKey: 'DrawerState',\n  setTabindex: true,\n  transition: true\n};\n","import { addClass, hasClass, removeClass } from '@vrembem/core/index';\nimport { setInert, setOverflowHidden } from '@vrembem/core/index';\n\nexport async function switchToModal(drawerKey, obj) {\n  // Initial guards\n  const drawer = obj.getDrawer(drawerKey);\n  if (!drawer) return obj.drawerNotFound(drawerKey);\n  if (hasClass(drawer, obj.settings.classModal)) return;\n\n  // Enable modal state\n  addClass(drawer, obj.settings.classModal);\n  addClass(drawer, obj.settings.stateClosed);\n  removeClass(drawer, obj.settings.stateOpened);\n\n  // Dispatch custom event\n  drawer.dispatchEvent(new CustomEvent(obj.settings.customEventPrefix + 'toModal', {\n    bubbles: true\n  }));\n  return drawer;\n}\n\nexport async function switchToDefault(drawerKey, obj) {\n  // Initial guards\n  const drawer = obj.getDrawer(drawerKey);\n  if (!drawer) return obj.drawerNotFound(drawerKey);\n  if (!hasClass(drawer, obj.settings.classModal)) return;\n\n  // Tear down modal state\n  setInert(false, obj.settings.selectorInert);\n  setOverflowHidden(false, obj.settings.selectorOverflow);\n  removeClass(drawer, obj.settings.classModal);\n  obj.focusTrap.destroy();\n\n  // Restore drawers saved state\n  drawerKey = drawer.getAttribute(`data-${obj.settings.dataDrawer}`);\n  const drawerState = obj.state[drawerKey];\n  if (drawerState == obj.settings.stateOpened) {\n    addClass(drawer, obj.settings.stateOpened);\n    removeClass(drawer, obj.settings.stateClosed);\n  }\n\n  // Dispatch custom event\n  drawer.dispatchEvent(new CustomEvent(obj.settings.customEventPrefix + 'toDefault', {\n    bubbles: true\n  }));\n  return drawer;\n}\n","import { switchToDefault, switchToModal } from './switchTo';\n\nexport class Breakpoint {\n  constructor(parent) {\n    this.mediaQueryLists = [];\n    this.parent = parent;\n    this.__check = this.check.bind(this);\n  }\n\n  init() {\n    const drawers = document.querySelectorAll(`[data-${this.parent.settings.dataBreakpoint}]`);\n    drawers.forEach((drawer) => {\n      const id = drawer.getAttribute(`data-${this.parent.settings.dataDrawer}`);\n      const key = drawer.getAttribute(`data-${this.parent.settings.dataBreakpoint}`);\n      const bp = this.parent.settings.breakpoints[key] ? this.parent.settings.breakpoints[key] : key;\n      const mql = window.matchMedia('(min-width:' + bp + ')');\n      this.match(mql, drawer);\n      mql.addListener(this.__check);\n      this.mediaQueryLists.push({\n        'mql': mql,\n        'drawer': id\n      });\n    });\n  }\n\n  destroy() {\n    if (this.mediaQueryLists && this.mediaQueryLists.length) {\n      this.mediaQueryLists.forEach((item) => {\n        item.mql.removeListener(this.__check);\n      });\n    }\n    this.mediaQueryLists = null;\n  }\n\n  check(event = null) {\n    if (this.mediaQueryLists && this.mediaQueryLists.length) {\n      this.mediaQueryLists.forEach((item) => {\n        // If an event is passed, filter out drawers that don't match the query\n        // If event is null, run all drawers through match\n        let filter = (event) ? event.media == item.mql.media : true;\n        if (!filter) return;\n        const drawer = document.querySelector(\n          `[data-${this.parent.settings.dataDrawer}=\"${item.drawer}\"]`\n        );\n        if (drawer) this.match(item.mql, drawer);\n      });\n      document.dispatchEvent(new CustomEvent(this.parent.settings.customEventPrefix + 'breakpoint', {\n        bubbles: true\n      }));\n    }\n  }\n\n  match(mql, drawer) {\n    if (mql.matches) {\n      switchToDefault(drawer, this.parent);\n    } else {\n      switchToModal(drawer, this.parent);\n    }\n  }\n}\n","export function handlerClick(event) {\n  // Working catch\n  if (this.working) return;\n\n  // Toggle data trigger\n  let trigger = event.target.closest(`[data-${this.settings.dataToggle}]`);\n  if (trigger) {\n    const selector = trigger.getAttribute(`data-${this.settings.dataToggle}`);\n    this.memory.trigger = trigger;\n    this.toggle(selector);\n    event.preventDefault();\n    return;\n  }\n\n  // Open data trigger\n  trigger = event.target.closest(`[data-${this.settings.dataOpen}]`);\n  if (trigger) {\n    const selector = trigger.getAttribute(`data-${this.settings.dataOpen}`);\n    this.memory.trigger = trigger;\n    this.open(selector);\n    event.preventDefault();\n    return;\n  }\n\n  // Close data trigger\n  trigger = event.target.closest(`[data-${this.settings.dataClose}]`);\n  if (trigger) {\n    const selector = trigger.getAttribute(`data-${this.settings.dataClose}`);\n    if (selector) {\n      this.memory.trigger = trigger;\n      this.close(selector);\n    } else {\n      const target = event.target.closest(`[data-${this.settings.dataDrawer}]`);\n      if (target) this.close(target);\n    }\n    event.preventDefault();\n    return;\n  }\n\n  // Screen modal trigger\n  if (event.target.hasAttribute(`data-${this.settings.dataDrawer}`)) {\n    this.close(event.target);\n    return;\n  }\n}\n\nexport function handlerKeyup(event) {\n  // Working catch\n  if (this.working) return;\n\n  if (event.keyCode == 27) {\n    const target = document.querySelector(\n      `.${this.settings.classModal}.${this.settings.stateOpened}`\n    );\n    if (target) {\n      this.close(target);\n    }\n  }\n}\n","import { addClass, hasClass, removeClass } from '@vrembem/core/index';\n\nexport function stateSet(settings) {\n  // If save state is disabled\n  if (!settings.stateSave)\n    return stateClear(settings);\n\n  // If there isn't an existing state to set\n  if (!localStorage.getItem(settings.stateKey))\n    return stateSave(null, settings);\n\n  // Set the existing state\n  const state = JSON.parse(localStorage.getItem(settings.stateKey));\n  Object.keys(state).forEach((key) => {\n    const item = document.querySelector(\n      `[data-${settings.dataDrawer}=\"${key}\"]`\n    );\n    if (!item) return;\n    (state[key] == settings.stateOpened) ?\n      addClass(item, settings.stateOpened) :\n      removeClass(item, settings.stateOpened);\n  });\n  return state;\n}\n\nexport function stateSave(target, settings) {\n  // If save state is disabled\n  if (!settings.stateSave)\n    return stateClear(settings);\n\n  // Get the currently saved object if it exists\n  const state = (localStorage.getItem(settings.stateKey)) ?\n    JSON.parse(localStorage.getItem(settings.stateKey)) : {};\n\n  // Are we saving a single target or the entire suite?\n  const drawers = (target) ? [target] :\n    document.querySelectorAll(`[data-${settings.dataDrawer}]`);\n\n  // Loop through drawers and save their states\n  drawers.forEach((el) => {\n    if (hasClass(el, settings.classModal)) return;\n    const drawerKey = el.getAttribute(`data-${settings.dataDrawer}`);\n    state[drawerKey] = (hasClass(el, settings.stateOpened)) ?\n      settings.stateOpened : settings.stateClosed;\n  });\n\n  // Save to localStorage and return the state\n  localStorage.setItem(settings.stateKey, JSON.stringify(state));\n  return state;\n}\n\nexport function stateClear(settings) {\n  if (localStorage.getItem(settings.stateKey)) {\n    localStorage.removeItem(settings.stateKey);\n  }\n  return {};\n}\n","import { hasClass } from '@vrembem/core/index';\nimport { setInert, setOverflowHidden, setTabindex } from '@vrembem/core/index';\nimport { FocusTrap, focusTarget, focusTrigger } from '@vrembem/core/index';\nimport { openTransition, closeTransition } from '@vrembem/core/index';\n\nimport defaults from './src/js/defaults';\nimport { Breakpoint } from './src/js/breakpoint';\nimport { handlerClick, handlerKeyup } from './src/js/handlers';\nimport { stateClear, stateSave, stateSet } from './src/js/state';\nimport { switchToDefault, switchToModal } from './src/js/switchTo';\n\nexport default class Drawer {\n  constructor(options) {\n    this.defaults = defaults;\n    this.settings = { ...this.defaults, ...options };\n    this.working = false;\n    this.memory = {};\n    this.state = {};\n    this.focusTrap = new FocusTrap();\n    this.breakpoint = new Breakpoint(this);\n    this.__handlerClick = handlerClick.bind(this);\n    this.__handlerKeyup = handlerKeyup.bind(this);\n    if (this.settings.autoInit) this.init();\n  }\n\n  init(options = null) {\n    if (options) this.settings = { ...this.settings, ...options };\n    this.stateSet();\n    this.setTabindex(this.settings.setTabindex);\n    this.breakpoint.init();\n    document.addEventListener('click', this.__handlerClick, false);\n    document.addEventListener('touchend', this.__handlerClick, false);\n    document.addEventListener('keyup', this.__handlerKeyup, false);\n  }\n\n  destroy() {\n    this.breakpoint.destroy();\n    this.memory = {};\n    this.state = {};\n    localStorage.removeItem(this.settings.stateKey);\n    document.removeEventListener('click', this.__handlerClick, false);\n    document.removeEventListener('touchend', this.__handlerClick, false);\n    document.removeEventListener('keyup', this.__handlerKeyup, false);\n  }\n\n  /**\n   * Helpers\n   */\n\n  getDrawer(drawerKey) {\n    if (typeof drawerKey !== 'string') return drawerKey;\n    return document.querySelector(\n      `[data-${this.settings.dataDrawer}=\"${drawerKey}\"]`\n    );\n  }\n\n  drawerNotFound(key) {\n    return Promise.reject(\n      new Error(`Did not find drawer with key: \"${key}\"`)\n    );\n  }\n\n  setTabindex(state = true) {\n    const selectorTabindex = `\n      [data-${this.settings.dataDrawer}]\n      [data-${this.settings.dataDialog}]\n    `;\n    setTabindex(state, selectorTabindex);\n  }\n\n  /**\n   * Save state functionality\n   */\n\n  stateSet() {\n    this.state = stateSet(this.settings);\n  }\n\n  stateSave(target = null) {\n    this.state = stateSave(target, this.settings);\n  }\n\n  stateClear() {\n    this.state = stateClear(this.settings);\n  }\n\n  /**\n   * SwitchTo functionality\n   */\n\n  switchToDefault(drawerKey) {\n    return switchToDefault(drawerKey, this);\n  }\n\n  switchToModal(drawerKey) {\n    return switchToModal(drawerKey, this);\n  }\n\n  /**\n   * Change state functionality\n   */\n\n  async toggle(drawerKey) {\n    const drawer = this.getDrawer(drawerKey);\n    if (!drawer) return this.drawerNotFound(drawerKey);\n    const isOpen = hasClass(drawer, this.settings.stateOpened);\n    if (!isOpen) {\n      return this.open(drawer);\n    } else {\n      return this.close(drawer);\n    }\n  }\n\n  async open(drawerKey) {\n    const drawer = this.getDrawer(drawerKey);\n    if (!drawer) return this.drawerNotFound(drawerKey);\n    if (!hasClass(drawer, this.settings.stateOpened)) {\n      this.working = true;\n      const isModal = hasClass(drawer, this.settings.classModal);\n      if (isModal) {\n        setOverflowHidden(true, this.settings.selectorOverflow);\n      }\n      await openTransition(drawer, this.settings);\n      this.stateSave(drawer);\n      if (isModal) {\n        this.focusTrap.init(drawer);\n        setInert(true, this.settings.selectorInert);\n      }\n      focusTarget(drawer, this.settings);\n      drawer.dispatchEvent(new CustomEvent(this.settings.customEventPrefix + 'opened', {\n        bubbles: true\n      }));\n      this.working = false;\n      return drawer;\n    } else {\n      focusTarget(drawer, this.settings);\n      return drawer;\n    }\n  }\n\n  async close(drawerKey) {\n    const drawer = this.getDrawer(drawerKey);\n    if (!drawer) return this.drawerNotFound(drawerKey);\n    if (hasClass(drawer, this.settings.stateOpened)) {\n      this.working = true;\n      if (hasClass(drawer, this.settings.classModal)) {\n        setInert(false, this.settings.selectorInert);\n        setOverflowHidden(false, this.settings.selectorOverflow);\n      }\n      await closeTransition(drawer, this.settings);\n      this.stateSave(drawer);\n      focusTrigger(this);\n      this.focusTrap.destroy();\n      drawer.dispatchEvent(new CustomEvent(this.settings.customEventPrefix + 'closed', {\n        bubbles: true\n      }));\n      this.working = false;\n      return drawer;\n    } else {\n      return drawer;\n    }\n  }\n}\n"],"names":["autoInit","dataDrawer","dataDialog","dataToggle","dataOpen","dataClose","dataBreakpoint","dataFocus","stateOpened","stateOpening","stateClosing","stateClosed","classModal","selectorInert","selectorOverflow","breakpoints","customEventPrefix","stateSave","stateKey","setTabindex","transition","switchToModal","drawerKey","obj","drawer","getDrawer","drawerNotFound","hasClass","settings","addClass","removeClass","dispatchEvent","CustomEvent","bubbles","switchToDefault","setInert","setOverflowHidden","focusTrap","destroy","getAttribute","drawerState","state","Breakpoint","constructor","parent","mediaQueryLists","__check","check","bind","init","drawers","document","querySelectorAll","forEach","id","key","bp","mql","window","matchMedia","match","addListener","push","length","item","removeListener","event","filter","media","querySelector","matches","handlerClick","working","trigger","target","closest","selector","memory","toggle","preventDefault","open","close","hasAttribute","handlerKeyup","keyCode","stateSet","stateClear","localStorage","getItem","JSON","parse","Object","keys","el","setItem","stringify","removeItem","Drawer","options","defaults","FocusTrap","breakpoint","__handlerClick","__handlerKeyup","addEventListener","removeEventListener","Promise","reject","Error","selectorTabindex","isOpen","isModal","openTransition","focusTarget","closeTransition","focusTrigger"],"mappings":"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"}