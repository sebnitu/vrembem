---
import type { CollectionEntry } from "astro:content";
import { getPackages } from "../../modules/getPackages";
import Base from "../../layouts/Base.astro";
import Navi from "../../components/CollectionNavi.astro";
import Pagi from "../../components/CollectionPagi.astro";
import OnThisPage from "../../components/OnThisPage.astro";
import LinkEditPage from "../../components/LinkEditPage.astro";
import Pre from "../../components/Pre.astro";
import Table from "../../components/Table.astro";

interface Props {
  entry: CollectionEntry<"packages">;
}

export async function getStaticPaths() {
  const packages = await getPackages();
  return packages.map((entry) => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

const entries = await getPackages();
const { entry } = Astro.props;
const { Content, headings } = await entry.render();

const layout = {
  hasDrawer: true,
  hasAside: true,
};

---

<Base title={entry.data.title} {layout}>
  <div slot="drawer">
    <Navi {entries} collection="packages" />
  </div>
  <div slot="aside">
    <OnThisPage {headings} />
  </div>
  <Content components={{ pre: Pre, table: Table }} />
  <div slot="append" class="gap-y-xl">
    <LinkEditPage />
    <hr class="sep" />
    <Pagi {entries} collection="packages" />
  </div>
</Base>

<script>
  // @ts-nocheck
  import { headerAnchor } from "../../modules/headerAnchor";
  import { tabs } from "../../modules/tabs";
  import { toggle } from "../../modules/toggle";
  import "../../modules/currentViewport";

  headerAnchor.mount();
  tabs.mount();
  toggle.mount();

  // Checkboxes
  const checkboxes = document.querySelectorAll(
    "input[type='checkbox'][aria-checked='mixed']"
  );
  checkboxes.forEach((checkbox) => checkbox.indeterminate = true);

  // Dismissible
  const btns = document.querySelectorAll("[data-dismiss]");
  btns.forEach((btn) => {
    btn.addEventListener("click", (event) => {
      const selector = btn.getAttribute("data-dismiss");
      const result = event.target.closest(selector);
      if (result) result.classList.add("display-none");
    });
  });
</script>
